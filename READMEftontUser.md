# Описание работы фронта

## Задачи

1. Авторизация пользователя.
2. Функционала чата.

## Страницы

1. Главная страница.
2. Страница входа.
3. Страница чата.

[Схема](https://miro.com/welcomeonboard/c1gzSnZBVU1JRWpQdTNoTXFZUjRzcHJtQ245c0NBZ20zZVNiOGoyak9YYlVibFc3bUdUa0V5ZzlIc2dUUjRkcXwzMDc0NDU3MzY0NjgwOTI5MTE5fDI=?share_link_id=873914533749)

### Главная страница содержит

- шапку с кнопкой перехода на страницу авторизации и навигацией по страницам
- тело с произвольным описанием

### Страница входа содержит

- шапку с кнопкой перехода на страницу авторизации и навигацией по страницам
- блок с формой входа пользователя

1. Пользователь вводит логин, пароль в форму ввода и нажимает кнопку "Войти"
2. Фронт отправляет POST запрос на эндпоинт /v1/auth/ с данными которые ввёл пользователь.   
   Формат принимаемого объекта:

```json
{
  "user_name": "user1",
  "password": "password1"
}
```

3.1. При неуспешной авторизации возвращается пустой ответ со статус кодом 403.

3.2. При успешном ответе возвращается Json объект следующего типа:
Пример Положительного ответа

```json
{
  "error": null,
  "result": {
    "token": "QWERTYUIOP"
  },
  "id": 6
}
```

В котором предоставляется токен авторизации. (токен потребуется для работы с чатом)  
3.2.1. В шапках страниц кнопка "Войти" меняется на "Выйти"

3.2.2. При успешной авторизации пользователь перенаправляется на главную страницу.

### Страница входа содержит

_Отображается только авторизованному пользователю._

- шапку с кнопкой выхода и навигацией по страницам
- блок с чатом с тех. поддержкой

**Основную часть экрана занимает блок с сообщениями чата**

1. При переходе пользователя на страницу чата инициируется WebSocket подключение на порт 49009.
2. После установки соединения фронт запрашивает авторизацию для своего подключения по средствам отправки токена
   авторизации:

   Формат принимаемого сообщения:

```json
{
  "method": "message.auth",
  "params": [
    "QWERTYUIOP"
  ],
  "id": 1
}
```

2.1. В случае неправильных данных или некорректного токена соединение разрывается.

2.2. В случае удачной авторизации в ответ приходит список сообщений пользователя:

2.2.1 Если записи есть:

```json
{
  "error": null,
  "result": {
    "messages": [
      {
        "message_id": 1,
        "message_text": "Message from Client",
        "invader_name": "",
        "is_from_support": false,
        "created": 1678794555,
        "is_read": true
      },
      {
        "message_id": 2,
        "message_text": "Message from Operator",
        "invader_name": "Operator1",
        "is_from_support": true,
        "created": 1678794555,
        "is_read": false
      }
    ]
  },
  "id": 1
}
```

2.2.1.1. Сообщения отображаются в окне с сообщениями (сообщения пользователя прилипают к правой части экрана сообщения
оператора к левой)

2.2.2 Если записей нет:

```json
{
  "error": null,
  "result": {
    "messages": null
  },
  "id": 1
}
```

**Под блоком с сообщениями чата есть форма для набора сообщения пользователя**

1. Пользователь набирает текст и нажимает кнопку "Отправить".
2. Сообщение отправляется через поддерживаемое подключение WebSocket:

Формат принимаемого сообщения:

```json
{
  "method": "message.send",
  "params": [
    "message"
  ],
  "id": 1
}
```

2.2.1 При удачной отправке сообщения в ответ поступает сообщение следующего формата:

```json
{
  "error": null,
  "result": {
    "message": {
      "message_id": 3,
      "message_text": "Message from Client",
      "invader_name": "",
      "is_from_support": false,
      "created": 1678794555,
      "is_read": false
    }
  },
  "id": 3
}
```

2.2.1.1 Добавить сообщение в нижнюю часть блока сообщений

2.2.2 При не удачной отправке сообщения в ответ поступает сообщение следующего формата:

```json
{
  "error": {
    "code": 1,
    "message": "Incorrect argument."
  },
  "result": null,
  "id": 1
}
```

**Пока пользователь не ушел со страницы с чатом ему могут прийти новые сообщения**

1. При поступлении нового сообщения приходить сообщение следующего формата:

```json
{
  "error": null,
  "result": {
    "message": {
      "message_id": 3,
      "message_text": "Message from Operator",
      "invader_name": "Operator1",
      "is_from_support": true,
      "created": 1678794555
    }
  },
  "id": 3
}
```

1.1. Добавить сообщение в нижнюю часть блока сообщений.